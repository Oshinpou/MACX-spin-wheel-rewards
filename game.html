<!DOCTYPE html>
<html>
<head>
    <title>MACX Crypto Wheel - Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: Arial, sans-serif;
            color: #fff;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        canvas {
            border: 5px solid #D4AF37;
            border-radius: 50%;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #D4AF37;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #b7952c;
        }
        .logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: #ff4d4d;
            color: #fff;
            border: none;
            border-radius: 5px;
        }
        .nav-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .nav-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 5px;
        }
        .nav-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>

    <!-- Logout Button -->
    <button class="logout-btn" onclick="logout()">Logout</button>

    <div id="game-container">
        <h2>Welcome, <span id="username"></span>!</h2>
        <h3>Your Points: <span id="points">0</span></h3>

        <!-- Spin Wheel Section -->
        <canvas id="wheelCanvas" width="300" height="300"></canvas>
        <button onclick="spinWheel()">Spin the Wheel</button>

        <p id="adStatus"></p>

        <!-- Navigation Section -->
        <div class="nav-container">
            <button class="nav-btn" onclick="window.location.href='withdraw.html'">Withdraw</button>
            <button class="nav-btn" onclick="window.location.href='faq.html'">FAQ</button>
            <button class="nav-btn" onclick="window.location.href='about.html'">About</button>
            <button class="nav-btn" onclick="window.location.href='tokens.html'">MACX Tokens</button>
            <button class="nav-btn" onclick="window.location.href='contact.html'">Contact Us / Help</button>
        </div>
    </div>

    <script>
        // Load logged-in user data
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!loggedInUser) {
            alert('‚ùå No user logged in. Redirecting to login page.');
            window.location.href = 'login.html';
        } else {
            document.getElementById('username').innerText = loggedInUser.username;
            document.getElementById('points').innerText = loggedInUser.points;
        }

        // Wheel Setup
        const wheelCanvas = document.getElementById('wheelCanvas');
        const wheelCtx = wheelCanvas.getContext('2d');
        const wheelSegments = [10, 20, 30, 40, 50, 100, 200, 500];
        const wheelColors = ['#FFD700', '#FFA500', '#FF6347', '#40E0D0', '#8A2BE2', '#FF69B4', '#1E90FF', '#32CD32'];
        const segmentAngle = 2 * Math.PI / wheelSegments.length;
        let isSpinning = false;
        let spinPoints = 0;

        // Draw Wheel
        function drawWheel() {
            for (let i = 0; i < wheelSegments.length; i++) {
                wheelCtx.beginPath();
                wheelCtx.fillStyle = wheelColors[i];
                wheelCtx.moveTo(150, 150);
                wheelCtx.arc(150, 150, 150, i * segmentAngle, (i + 1) * segmentAngle);
                wheelCtx.lineTo(150, 150);
                wheelCtx.fill();

                wheelCtx.fillStyle = '#000';
                wheelCtx.font = '14px Arial';
                wheelCtx.fillText(wheelSegments[i] + ' pts', 120 + 70 * Math.cos(i * segmentAngle + segmentAngle / 2), 130 + 70 * Math.sin(i * segmentAngle + segmentAngle / 2));
            }
        }
        drawWheel();

        // Spin Wheel Logic
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;

            let randomAngle = Math.random() * 2 * Math.PI + 10 * 2 * Math.PI;
            let spinDuration = 3000;
            let startTime = null;

            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsedTime = timestamp - startTime;

                const progress = Math.min(elapsedTime / spinDuration, 1);
                const currentAngle = progress * randomAngle;

                wheelCanvas.style.transform = `rotate(${currentAngle}rad)`;

                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    const finalSegmentIndex = Math.floor(((randomAngle % (2 * Math.PI)) / segmentAngle)) % wheelSegments.length;
                    spinPoints = wheelSegments[finalSegmentIndex];
                    askToWatchAd();
                    isSpinning = false;
                }
            }
            requestAnimationFrame(animateSpin);
        }

        // Prompt to Watch Ad for Points
        function askToWatchAd() {
            const adConfirmation = confirm(`üé• Watch an ad to collect ${spinPoints} points?`);
            if (adConfirmation) {
                watchAdToCollectPoints(spinPoints);
            } else {
                spinPoints = 0;
                alert('‚ùå You skipped the ad. Points not collected.');
            }
        }

        // Watch Ad to Collect Points
        function watchAdToCollectPoints(points) {
            document.getElementById('adStatus').innerText = 'üé• Watching ad...';
            setTimeout(() => {
                document.getElementById('adStatus').innerText = '‚úÖ Ad watched! Points added.';
                updatePoints(points);
            }, 5000); // Simulate 5-second ad
        }

        // Update Points after Watching Ad
        function updatePoints(points) {
            loggedInUser.points += points;
            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));

            let users = JSON.parse(localStorage.getItem('users')) || [];
            let userIndex = users.findIndex(user => user.username === loggedInUser.username);
            if (userIndex !== -1) {
                users[userIndex].points = loggedInUser.points;
                localStorage.setItem('users', JSON.stringify(users));
            }

            document.getElementById('points').innerText = loggedInUser.points;
            alert(`üéâ You collected ${points} points!`);
        }

        // Logout Function
        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
