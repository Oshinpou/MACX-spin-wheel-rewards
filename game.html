<!DOCTYPE html>
<html>
<head>
    <title>MACX Crypto Wheel - Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: Arial, sans-serif;
            color: #fff;
            overflow: hidden;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .wheel-container {
            text-align: center;
        }
        #wheelCanvas {
            width: 300px;
            height: 300px;
            border: 5px solid #D4AF37;
            border-radius: 50%;
            background: #fff;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #D4AF37;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #b7952c;
        }
        #points-container {
            margin-top: 20px;
        }
        #ad-container {
            margin-top: 20px;
            background-color: rgba(34, 34, 34, 0.9);
            padding: 20px;
            border-radius: 10px;
        }
        .logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: #ff4d4d;
            color: #fff;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="particleCanvas"></canvas>

    <!-- Logout Button -->
    <button class="logout-btn" onclick="logout()">Logout</button>

    <div id="game-container">
        <div class="wheel-container">
            <h2>Welcome, <span id="username"></span>!</h2>
            <h3>Your Points: <span id="points">0</span></h3>
            <canvas id="wheelCanvas"></canvas>
            <button onclick="spinWheel()">Spin the Wheel</button>

            <!-- Ad Container to Watch Ads for Points -->
            <div id="ad-container">
                <h3>Watch Ad to Earn 50 Bonus Points</h3>
                <button onclick="watchAd()">Watch Ad</button>
                <p id="adStatus"></p>
            </div>
        </div>
    </div>

    <script>
        // Particle Background Animation
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        for (let i = 0; i < 100; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 3,
                dx: Math.random() - 0.5,
                dy: Math.random() - 0.5
            });
        }

        function drawParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#D4AF37';
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();

                p.x += p.dx;
                p.y += p.dy;

                if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
            });
            requestAnimationFrame(drawParticles);
        }
        drawParticles();

        // Load logged-in user data
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!loggedInUser) {
            alert('‚ùå No user logged in. Redirecting to login page.');
            window.location.href = 'login.html';
        } else {
            document.getElementById('username').innerText = loggedInUser.username;
            document.getElementById('points').innerText = loggedInUser.points;
        }

        // Spin Wheel Setup
        const wheelCanvas = document.getElementById('wheelCanvas');
        const wheelCtx = wheelCanvas.getContext('2d');
        const wheelSegments = [10, 20, 30, 40, 50, 100, 200, 500];
        const wheelColors = ['#FFD700', '#FFA500', '#FF6347', '#40E0D0', '#8A2BE2', '#FF69B4', '#1E90FF', '#32CD32'];
        const segmentAngle = 2 * Math.PI / wheelSegments.length;
        let isSpinning = false;

        // Draw Wheel
        function drawWheel() {
            for (let i = 0; i < wheelSegments.length; i++) {
                wheelCtx.beginPath();
                wheelCtx.fillStyle = wheelColors[i];
                wheelCtx.moveTo(150, 150);
                wheelCtx.arc(150, 150, 150, i * segmentAngle, (i + 1) * segmentAngle);
                wheelCtx.lineTo(150, 150);
                wheelCtx.fill();

                wheelCtx.fillStyle = '#000';
                wheelCtx.font = '16px Arial';
                wheelCtx.fillText(wheelSegments[i] + ' pts', 120 + 70 * Math.cos(i * segmentAngle + segmentAngle / 2), 130 + 70 * Math.sin(i * segmentAngle + segmentAngle / 2));
            }
        }
        drawWheel();

        // Spin Wheel Logic
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;

            let randomAngle = Math.random() * 2 * Math.PI + 10 * 2 * Math.PI;
            let spinDuration = 3000;
            let startTime = null;

            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsedTime = timestamp - startTime;

                const progress = Math.min(elapsedTime / spinDuration, 1);
                const currentAngle = progress * randomAngle;

                wheelCanvas.style.transform = `rotate(${currentAngle}rad)`;

                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    const finalSegmentIndex = Math.floor(((randomAngle % (2 * Math.PI)) / segmentAngle)) % wheelSegments.length;
                    const pointsWon = wheelSegments[finalSegmentIndex];
                    updatePoints(pointsWon);
                    isSpinning = false;
                }
            }
            requestAnimationFrame(animateSpin);
        }

        // Update Points in Local Storage
        function updatePoints(points) {
            loggedInUser.points += points;
            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));

            let users = JSON.parse(localStorage.getItem('users')) || [];
            let userIndex = users.findIndex(user => user.username === loggedInUser.username);
            if (userIndex !== -1) {
                users[userIndex].points = loggedInUser.points;
                localStorage.setItem('users', JSON.stringify(users));
            }

            document.getElementById('points').innerText = loggedInUser.points;
            alert(`üéâ You won ${points} points!`);
        }

        // Watch Ad for Bonus Points (Ad points NOT added to user's saved data)
        function watchAd() {
            document.getElementById('adStatus').innerText = 'üé• Watching ad...';
            setTimeout(() => {
                document.getElementById('adStatus').innerText = '‚úÖ Ad watched! You earned 50 bonus points.';
                alert('üéâ You earned 50 bonus points!');
            }, 5000);
        }

        // Logout Function
        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
